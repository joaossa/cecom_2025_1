generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model Master {
  id            Int            @id @default(autoincrement()) @map("codigo")
  nome          String         @map("nome") @db.VarChar(120)
  dtCadastro    DateTime       @default(now()) @map("dtCadastro") @db.Timestamptz(6)
  stInativo     SimNao?        @map("stInativo")
  pacientes     Paciente[]
  profissionais Profissional[]
  usuarioAuths  UsuarioAuth[]

  @@map("master")
  
}

model Paciente {
  cdMaster            Int
  cdPaciente          Int
  nome                String               @db.VarChar(120)
  sexo                Sexo?                @map("sexo")
  dtNascimento        DateTime?            @map("dtNascimento") @db.Date
  stInativo           SimNao?              @map("stInativo")
  cdEscolaridade      Int?                 @map("cdEscolaridade")
  cdOcupacao          Int?                 @map("cdOcupacao")
  atendimentos        Atendimento[]
  contatos            ContatoPaciente[]
  enderecos           EnderecoPaciente[]
  evolucoes           Evolucao[]
  escolaridade        Escolaridade?        @relation(fields: [cdEscolaridade], references: [id])
  master              Master               @relation(fields: [cdMaster], references: [id])
  ocupacao            Ocupacao?            @relation(fields: [cdOcupacao], references: [id])
  parentescoPacientes ParentescoPaciente[]
  usuarioAuths        UsuarioAuth[]

  @@id([cdMaster, cdPaciente])
  @@map("pacientes")
  
}

model Profissional {
  id                Int                    @id @default(autoincrement())
  cdMaster          Int                    @map("cdMaster")
  nome              String                 @db.VarChar(120)
  sexo              Sexo?                  @map("sexo")
  conselho          String?                @map("conselho") @db.VarChar(30)
  stInativo         SimNao?                @map("stInativo")
  cdOcupacao        Int?                   @map("cdOcupacao")
  afericoesClinicas AfericaoClinica[]
  atendimentos      Atendimento[]
  contatos          ContatoProfissional[]
  enderecos         EnderecoProfissional[]
  evaDores          EvaDor[]
  evolucoes         Evolucao[]
  glasgows          Glasgow[]
  master            Master                 @relation(fields: [cdMaster], references: [id])
  ocupacao          Ocupacao?              @relation(fields: [cdOcupacao], references: [id])
  usuarioAuths      UsuarioAuth[]

  @@map("profissionais")
  
}

model Endereco {
  id                         Int                         @id @default(autoincrement())
  logradouro                 String                      @db.VarChar(120)
  numero                     String?                     @db.VarChar(10)
  complemento                String?                     @db.VarChar(50)
  cdBairro                   Int
  cdCidade                   Int
  cep                        String                      @db.VarChar(9)
  stInativo                  SimNao?                     @map("stInativo")
  bairro                     Bairro                      @relation(fields: [cdBairro], references: [id])
  cidade                     Cidade                      @relation(fields: [cdCidade], references: [id])
  pacientes                  EnderecoPaciente[]
  enderecoPessoaRelacionadas EnderecoPessoaRelacionada[]
  profissionais              EnderecoProfissional[]

  @@map("enderecos")
  
}

model EnderecoPaciente {
  id         Int      @id @default(autoincrement())
  cdMaster   Int
  cdPaciente Int
  cdEndereco Int
  endereco   Endereco @relation(fields: [cdEndereco], references: [id])
  paciente   Paciente @relation(fields: [cdMaster, cdPaciente], references: [cdMaster, cdPaciente])

  @@map("enderecospacientes")
  
}

model EnderecoProfissional {
  id           Int          @id @default(autoincrement())
  cdProf       Int
  cdEndereco   Int
  endereco     Endereco     @relation(fields: [cdEndereco], references: [id])
  profissional Profissional @relation(fields: [cdProf], references: [id])

  @@map("enderecosprofissionais")
  
}

model Contato {
  id            Int                   @id @default(autoincrement())
  tipo          TipoFone              @map("tpTelefone")
  numero        String                @db.VarChar(20)
  stInativo     SimNao?               @map("stInativo")
  pacientes     ContatoPaciente[]
  profissionais ContatoProfissional[]

  @@map("contatos")
  
}

model ContatoPaciente {
  id         Int      @id @default(autoincrement())
  cdMaster   Int
  cdPaciente Int
  cdContato  Int
  contato    Contato  @relation(fields: [cdContato], references: [id])
  paciente   Paciente @relation(fields: [cdMaster, cdPaciente], references: [cdMaster, cdPaciente])

  @@map("contatospacientes")
  
}

model ContatoProfissional {
  id           Int          @id @default(autoincrement())
  cdProf       Int
  cdContato    Int
  contato      Contato      @relation(fields: [cdContato], references: [id])
  profissional Profissional @relation(fields: [cdProf], references: [id])

  @@map("contatosprofissionais")
  
}

model Atendimento {
  id                Int               @id @default(autoincrement())
  cdMaster          Int
  cdPaciente        Int
  cdProfissional    Int               @map("cdProf")
  data              DateTime          @db.Timestamptz(6)
  observacao        String?           @db.VarChar(500)
  afericoesClinicas AfericaoClinica[]
  paciente          Paciente          @relation(fields: [cdMaster, cdPaciente], references: [cdMaster, cdPaciente], onDelete: Cascade)
  profissional      Profissional      @relation(fields: [cdProfissional], references: [id])
  evaDores          EvaDor[]
  evolucoes         Evolucao[]
  glasgows          Glasgow[]
  sinaisVitais      SinaisVitais[]

  @@map("atendimentos")
  
}

model Evolucao {
  id                    Int                  @id @default(autoincrement())
  cdAtendimento         Int
  cdProfissional        Int?
  data                  DateTime             @db.Timestamptz(6)
  texto                 String               @db.VarChar(2000)
  pacienteCdMaster      Int?
  pacienteCdPaciente    Int?
  tipoEvolucaoClinicaId Int?
  atendimento           Atendimento          @relation(fields: [cdAtendimento], references: [id], onDelete: Cascade)
  profissional          Profissional?        @relation(fields: [cdProfissional], references: [id])
  paciente              Paciente?            @relation(fields: [pacienteCdMaster, pacienteCdPaciente], references: [cdMaster, cdPaciente])
  tipoEvolucaoClinica   TipoEvolucaoClinica? @relation(fields: [tipoEvolucaoClinicaId], references: [id])
  cid                   EvolucaoCid[]
  dsm                   EvolucaoDsm[]

  @@map("evolucoes")
  
}

model PessoaRelacionada {
  id          Int                         @id @default(autoincrement())
  nome        String                      @db.VarChar(120)
  telefone    String?                     @db.VarChar(20)
  stInativo   SimNao?                     @map("stInativo")
  enderecos   EnderecoPessoaRelacionada[]
  parentescos ParentescoPaciente[]

  @@map("pessoasrelacionadas")
  
}

model ParentescoPaciente {
  id                Int               @id @default(autoincrement())
  cdMaster          Int
  cdPaciente        Int
  cdPessoa          Int
  parentesco        TipoParentesco    @map("tipo")
  paciente          Paciente          @relation(fields: [cdMaster, cdPaciente], references: [cdMaster, cdPaciente])
  pessoaRelacionada PessoaRelacionada @relation(fields: [cdPessoa], references: [id])

  @@map("parentescospacientes")
  
}

model Plano {
  id        Int     @id @default(autoincrement())
  descricao String  @db.VarChar(120)
  stInativo SimNao? @map("stInativo")

  @@map("planos")
  
}

model Motivo {
  id        Int     @id @default(autoincrement())
  descricao String  @db.VarChar(200)
  stInativo SimNao? @map("stInativo")

  @@map("motivos")
  
}

model TipoProcedimento {
  id        Int     @id @default(autoincrement())
  descricao String  @db.VarChar(120)
  stInativo SimNao? @map("stInativo")

  @@map("tiposprocedimentos")
  
}

model TipoEvolucaoSimples {
  id        Int     @id @default(autoincrement())
  descricao String  @db.VarChar(120)
  stInativo SimNao? @map("stInativo")

  @@map("tiposevolucaosimples")
  
}

model Pais {
  id            Int      @id @default(autoincrement()) @db.SmallInt
  descricao     String   @db.VarChar(60)
  nacionalidade String?  @db.VarChar(60)
  cdIbge        Int?
  cidades       Cidade[]
  ufs           UnidadeFederacao[]

  @@map("paises")
  
}

model UnidadeFederacao {
  id          String   @id @db.Char(2)      // "BA", "SP", etc.
  descricao   String   @db.VarChar(60)      // "Bahia"
  cdIbge      Int?                           // c√≥digo IBGE do estado
  cdPais      Int

  pais        Pais      @relation(fields: [cdPais], references: [id])
  cidades     Cidade[]

  @@index([cdPais])
  @@map("unidadesfederacao")
}

model Cidade {
  id        Int              @id @default(autoincrement())
  descricao String           @db.VarChar(120)
  cdUf      String           @db.Char(2)
  cdPais    Int
  cepGeral  String?          @db.VarChar(9)
  cdIbge    Int?
  stInativo SimNao?          @map("stInativo")
  bairros   Bairro[]
  pais      Pais             @relation(fields: [cdPais], references: [id])
  uf        UnidadeFederacao @relation(fields: [cdUf], references: [id])
  distritos Distrito[]
  enderecos Endereco[]

  @@unique([descricao, cdUf])
  @@index([cdUf])
  @@index([cdPais])
  @@map("cidades")
    
}

model Escolaridade {
  id        Int        @id @default(autoincrement()) @db.SmallInt
  descricao String     @db.VarChar(120)
  stInativo SimNao?    @map("stInativo")
  pacientes Paciente[]

  @@map("escolaridades")
  
}

model Ocupacao {
  id            Int            @id @default(autoincrement()) @db.SmallInt
  descricao     String         @db.VarChar(120)
  cbo           String?        @db.VarChar(10)
  stInativo     SimNao?        @map("stInativo")
  pacientes     Paciente[]
  profissionals Profissional[]

  @@map("ocupacoes")
  
}

model Distrito {
  id        Int      @id @default(autoincrement())
  cdCidade  Int
  descricao String   @db.VarChar(120)
  stInativo SimNao?  @map("stInativo")
  bairros   Bairro[]
  cidade    Cidade   @relation(fields: [cdCidade], references: [id])

  @@map("distritos")
  
}

model Bairro {
  id         Int        @id @default(autoincrement())
  cdDistrito Int?
  cdCidade   Int
  descricao  String     @db.VarChar(120)
  stInativo  SimNao?    @map("stInativo")
  cidade     Cidade     @relation(fields: [cdCidade], references: [id])
  distrito   Distrito?  @relation(fields: [cdDistrito], references: [id])
  enderecos  Endereco[]

  @@map("bairros")
  
}

model EnderecoPessoaRelacionada {
  id                Int               @id @default(autoincrement())
  cdPessoa          Int
  cdEndereco        Int
  endereco          Endereco          @relation(fields: [cdEndereco], references: [id])
  pessoaRelacionada PessoaRelacionada @relation(fields: [cdPessoa], references: [id])

  @@map("enderecospessoasrelacionadas")
  
}

model Cid {
  id           Int           @id @default(autoincrement())
  codigo       String        @db.VarChar(10)
  descricao    String        @db.VarChar(300)
  versao       VersaoCid
  stInativo    SimNao?       @map("stInativo")
  evolucaoCids EvolucaoCid[]

  @@unique([codigo, versao])
  @@map("cid")
  
}

model Dsm {
  id           Int           @id @default(autoincrement())
  codigo       String        @db.VarChar(10)
  descricao    String        @db.VarChar(300)
  versao       VersaoDsm
  stInativo    SimNao?       @map("stInativo")
  evolucaoDsms EvolucaoDsm[]

  @@unique([codigo, versao])
  @@map("dsm")
  
}

model TipoEvolucaoClinica {
  id        Int        @id @default(autoincrement())
  descricao String     @db.VarChar(120)
  stInativo SimNao?    @map("stInativo")
  evolucaos Evolucao[]

  @@map("tiposevolucoesclinicas")
  
}

model EvolucaoCid {
  id         Int      @id @default(autoincrement())
  cdEvolucao Int
  cdCid      Int
  cid        Cid      @relation(fields: [cdCid], references: [id])
  evolucao   Evolucao @relation(fields: [cdEvolucao], references: [id])

  @@map("evolucoescid")
  
}

model EvolucaoDsm {
  id         Int      @id @default(autoincrement())
  cdEvolucao Int
  cdDsm      Int
  dsm        Dsm      @relation(fields: [cdDsm], references: [id])
  evolucao   Evolucao @relation(fields: [cdEvolucao], references: [id])

  @@map("evolucoesdsm")
  
}

model SinaisVitais {
  id            Int              @id @default(autoincrement())
  cdAtendimento Int
  data          DateTime         @default(now())
  paSistolica   Int?             @db.SmallInt
  paDiastolica  Int?             @db.SmallInt
  fc            Int?             @db.SmallInt
  fr            Int?             @db.SmallInt
  temperatura   Decimal?         @db.Decimal(4, 1)
  spo2          Int?             @db.SmallInt
  peso          Decimal?         @db.Decimal(5, 2)
  altura        Decimal?         @db.Decimal(4, 2)
  imc           Decimal?         @db.Decimal(5, 2)
  dor           Int?             @db.SmallInt
  escalaDorId   Int?
  posicao       PosicaoPaciente?
  origem        OrigemAfericao?  @default(MANUAL)
  metadataRaw   Json?
  atendimento   Atendimento      @relation(fields: [cdAtendimento], references: [id])
  escalaDor     EscalaDor?       @relation(fields: [escalaDorId], references: [id])

  @@map("sinaisvitais")
  
}

model EscalaDor {
  id           Int            @id @default(autoincrement())
  nome         String         @db.VarChar(100)
  descricao    String?        @db.VarChar(300)
  sinaisVitais SinaisVitais[]

  @@map("escalasdor")
  
}

model Glasgow {
  id             Int           @id @default(autoincrement())
  cdAtendimento  Int
  cdProfissional Int?          @map("cdProf")
  data           DateTime      @default(now()) @db.Timestamptz(6)
  ocular         Int
  verbal         Int
  motora         Int
  total          Int
  observacao     String?       @db.VarChar(300)
  atendimento    Atendimento   @relation(fields: [cdAtendimento], references: [id])
  profissional   Profissional? @relation(fields: [cdProfissional], references: [id])

  @@index([cdAtendimento])
  @@index([cdProfissional])
  @@map("glasgow")
  
}

model AfericaoClinica {
  id             Int           @id @default(autoincrement())
  cdAtendimento  Int
  cdProfissional Int?          @map("cdProf")
  escala         String        @db.VarChar(50)
  idRegistro     Int
  data           DateTime      @default(now()) @db.Timestamptz(6)
  atendimento    Atendimento   @relation(fields: [cdAtendimento], references: [id])
  profissional   Profissional? @relation(fields: [cdProfissional], references: [id])

  @@index([cdAtendimento])
  @@index([escala])
  @@map("afericoesclinicas")
  
}

model EvaDor {
  id             Int           @id @default(autoincrement())
  cdAtendimento  Int
  cdProfissional Int?
  data           DateTime      @default(now()) @db.Timestamptz(6)
  valor          Int
  observacao     String?       @db.VarChar(300)
  atendimento    Atendimento   @relation(fields: [cdAtendimento], references: [id])
  profissional   Profissional? @relation(fields: [cdProfissional], references: [id])

  @@index([cdAtendimento])
  @@index([cdProfissional])
  @@map("eva")
  
}

model UsuarioAuth {
  id             Int           @id @default(autoincrement())
  cdMaster       Int
  email          String        @db.VarChar(150)
  senhaHash      String        @db.VarChar(255)
  role           RoleAuth      @default(PROFISSIONAL)
  cdProfissional Int?
  cdPaciente     Int?
  paciente       Paciente?     @relation(fields: [cdMaster, cdPaciente], references: [cdMaster, cdPaciente], onDelete: SetNull)
  master         Master        @relation(fields: [cdMaster], references: [id])
  profissional   Profissional? @relation(fields: [cdProfissional], references: [id])

  @@unique([cdMaster, email])
  @@index([cdMaster])
  @@map("usuariosauth")
  
}

enum SimNao {
  S
  N

  
}

enum Sexo {
  M
  F
  I

  
}

enum VersaoCid {
  c9
  c10

  
}

enum VersaoDsm {
  d4
  d5

  
}

enum HumorIntensidade {
  NIVEL_1 @map("1")
  NIVEL_2 @map("2")
  NIVEL_3 @map("3")
  NIVEL_4 @map("4")
  NIVEL_5 @map("5")

  
}

enum OrigemAfericao {
  MANUAL
  OXIMETRO
  BALANCA
  RELOGIO_INTELIGENTE
  MONITOR_HOSPITALAR

  
}

enum PosicaoPaciente {
  SENTADO
  DEITADO
  ORTOSTATICO
  EM_PE

  
}

enum TipoFone {
  R
  T
  C
  P

  
}

enum TipoParentesco {
  P
  M
  T
  F
  C
  O
  R

  
}

enum RoleAuth {
  ADMIN
  PROFISSIONAL
  LEITURA

  
}

// ALTER TABLE public.paises ADD CONSTRAINT paises_cdibge_unique UNIQUE ("cdIbge");
